INFO:main:✅ OpenAI API 클라이언트 초기화 완료! (60초 타임아웃)
WARNING:main:⚠️ LangChain/LangGraph 모듈을 로드할 수 없습니다: No module named 'mediapipe'
INFO:     Started server process [63776]
INFO:     Waiting for application startup.
INFO:main:🚀 2025년 최신 AI 피부 분석기 서버 시작...
INFO:main:✨ OpenCV Face Detection 모델 로드 완료!
/Users/doriankim/Downloads/miniproject-son-2/backend/venv/lib/python3.13/site-packages/transformers/models/vit/feature_extraction_vit.py:30: FutureWarning: The class ViTFeatureExtractor is deprecated and will be removed in version 5 of Transformers. Please use ViTImageProcessor instead.
  warnings.warn(
INFO:main:✨ YOLOv8 여드름 감지 모델 로드 완료!
INFO:main:🚀 2025년 최신 AI 피부 분석기 초기화 완료
INFO:main:✅ 2025년 AI 분석기 준비 완료!
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8001 (Press CTRL+C to quit)
INFO:     127.0.0.1:63615 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:63719 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:63719 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:63814 - "OPTIONS /analyze-skin-base64 HTTP/1.1" 200 OK
INFO:main:원본 이미지 데이터 길이: 1536494
INFO:main:감지된 이미지 타입: data:image/png
INFO:main:정제된 Base64 데이터 길이: 1536472
INFO:main:디코딩된 바이트 길이: 1152353
INFO:main:numpy 배열 크기: 1152353
INFO:main:디코딩된 이미지 크기: (1024, 1024, 3)
INFO:main:🔍 YOLOv8 여드름 감지 시작...

0: 640x640 6 Acnes, 209.6ms
Speed: 1.7ms preprocess, 209.6ms inference, 0.8ms postprocess per image at shape (1, 3, 640, 640)
INFO:main:✅ YOLOv8 감지: 6개 발견
INFO:main:🔍 OpenCV 보완 감지 시작...
INFO:main:✅ OpenCV 추가 감지: 17개 발견
INFO:main:🎯 총 여드름 감지 완료: 23개 발견
INFO:main:  1. 위치(218, 91), 크기(16x14), 신뢰도: 0.774, 방법: opencv
INFO:main:  2. 위치(221, 49), 크기(12x19), 신뢰도: 0.742, 방법: opencv
INFO:main:  3. 위치(100, 143), 크기(14x9), 신뢰도: 0.683, 방법: opencv
INFO:main:  4. 위치(86, 126), 크기(17x26), 신뢰도: 0.682, 방법: opencv
INFO:main:  5. 위치(82, 85), 크기(12x12), 신뢰도: 0.663, 방법: opencv
INFO:main:  6. 위치(65, 182), 크기(5x9), 신뢰도: 0.652, 방법: yolo
INFO:main:  7. 위치(124, 143), 크기(7x3), 신뢰도: 0.599, 방법: opencv
INFO:main:  8. 위치(128, 218), 크기(6x6), 신뢰도: 0.572, 방법: yolo
INFO:main:  9. 위치(207, 122), 크기(13x9), 신뢰도: 0.539, 방법: opencv
INFO:main:  10. 위치(139, 57), 크기(14x8), 신뢰도: 0.486, 방법: opencv
INFO:main:  11. 위치(160, 0), 크기(4x3), 신뢰도: 0.454, 방법: opencv
INFO:main:  12. 위치(17, 88), 크기(3x5), 신뢰도: 0.452, 방법: opencv
INFO:main:  13. 위치(230, 74), 크기(3x3), 신뢰도: 0.450, 방법: opencv
INFO:main:  14. 위치(220, 40), 크기(3x4), 신뢰도: 0.450, 방법: opencv
INFO:main:  15. 위치(94, 98), 크기(6x11), 신뢰도: 0.420, 방법: opencv
INFO:main:  16. 위치(180, 191), 크기(7x19), 신뢰도: 0.409, 방법: opencv
INFO:main:  17. 위치(53, 93), 크기(3x3), 신뢰도: 0.374, 방법: opencv
INFO:main:  18. 위치(96, 203), 크기(5x5), 신뢰도: 0.371, 방법: yolo
INFO:main:  19. 위치(115, 160), 크기(7x5), 신뢰도: 0.349, 방법: opencv
INFO:main:  20. 위치(51, 142), 크기(6x8), 신뢰도: 0.347, 방법: opencv
INFO:main:  21. 위치(113, 206), 크기(4x5), 신뢰도: 0.339, 방법: yolo
INFO:main:  22. 위치(180, 163), 크기(7x11), 신뢰도: 0.293, 방법: yolo
INFO:main:  23. 위치(103, 46), 크기(6x7), 신뢰도: 0.183, 방법: yolo
INFO:main:🔄 좌표 변환 시작: 원본(1024x1024) -> 처리됨(512x512)
INFO:main:🔄 스케일 팩터: x=0.5000, y=0.5000
INFO:main:🔄 얼굴 박스: x=143, y=118, w=234, h=234
INFO:main:🔍 여드름 #1: 얼굴내(218,91) -> 전처리(361,209) -> 원본(722.0,418.0) -> 최종(722,418) 신뢰도:0.774
INFO:main:🔍 여드름 #2: 얼굴내(221,49) -> 전처리(364,167) -> 원본(728.0,334.0) -> 최종(728,334) 신뢰도:0.742
INFO:main:🔍 여드름 #3: 얼굴내(100,143) -> 전처리(243,261) -> 원본(486.0,522.0) -> 최종(486,522) 신뢰도:0.683
INFO:main:🔍 여드름 #4: 얼굴내(86,126) -> 전처리(229,244) -> 원본(458.0,488.0) -> 최종(458,488) 신뢰도:0.682
INFO:main:🔍 여드름 #5: 얼굴내(82,85) -> 전처리(225,203) -> 원본(450.0,406.0) -> 최종(450,406) 신뢰도:0.663
INFO:main:🔍 여드름 #6: 얼굴내(65,182) -> 전처리(208,300) -> 원본(416.0,600.0) -> 최종(416,600) 신뢰도:0.652
INFO:main:🔍 여드름 #7: 얼굴내(124,143) -> 전처리(267,261) -> 원본(534.0,522.0) -> 최종(534,522) 신뢰도:0.599
INFO:main:🔍 여드름 #8: 얼굴내(128,218) -> 전처리(271,336) -> 원본(542.0,672.0) -> 최종(542,672) 신뢰도:0.572
INFO:main:🔍 여드름 #9: 얼굴내(207,122) -> 전처리(350,240) -> 원본(700.0,480.0) -> 최종(700,480) 신뢰도:0.539
INFO:main:🔍 여드름 #10: 얼굴내(139,57) -> 전처리(282,175) -> 원본(564.0,350.0) -> 최종(564,350) 신뢰도:0.486
INFO:main:🔍 여드름 #11: 얼굴내(160,0) -> 전처리(303,118) -> 원본(606.0,236.0) -> 최종(606,236) 신뢰도:0.454
INFO:main:🔍 여드름 #12: 얼굴내(17,88) -> 전처리(160,206) -> 원본(320.0,412.0) -> 최종(320,412) 신뢰도:0.452
INFO:main:🔍 여드름 #13: 얼굴내(230,74) -> 전처리(373,192) -> 원본(746.0,384.0) -> 최종(746,384) 신뢰도:0.450
INFO:main:🔍 여드름 #14: 얼굴내(220,40) -> 전처리(363,158) -> 원본(726.0,316.0) -> 최종(726,316) 신뢰도:0.450
INFO:main:🔍 여드름 #15: 얼굴내(94,98) -> 전처리(237,216) -> 원본(474.0,432.0) -> 최종(474,432) 신뢰도:0.420
INFO:main:🔍 여드름 #16: 얼굴내(180,191) -> 전처리(323,309) -> 원본(646.0,618.0) -> 최종(646,618) 신뢰도:0.409
INFO:main:🔍 여드름 #17: 얼굴내(53,93) -> 전처리(196,211) -> 원본(392.0,422.0) -> 최종(392,422) 신뢰도:0.374
INFO:main:🔍 여드름 #18: 얼굴내(96,203) -> 전처리(239,321) -> 원본(478.0,642.0) -> 최종(478,642) 신뢰도:0.371
INFO:main:🔍 여드름 #19: 얼굴내(115,160) -> 전처리(258,278) -> 원본(516.0,556.0) -> 최종(516,556) 신뢰도:0.349
INFO:main:🔍 여드름 #20: 얼굴내(51,142) -> 전처리(194,260) -> 원본(388.0,520.0) -> 최종(388,520) 신뢰도:0.347
INFO:main:🔍 여드름 #21: 얼굴내(113,206) -> 전처리(256,324) -> 원본(512.0,648.0) -> 최종(512,648) 신뢰도:0.339
INFO:main:🔍 여드름 #22: 얼굴내(180,163) -> 전처리(323,281) -> 원본(646.0,562.0) -> 최종(646,562) 신뢰도:0.293
INFO:main:🔍 여드름 #23: 얼굴내(103,46) -> 전처리(246,164) -> 원본(492.0,328.0) -> 최종(492,328) 신뢰도:0.183
INFO:httpx:HTTP Request: POST https://api.openai.com/v1/responses "HTTP/1.1 200 OK"
INFO:main:OpenAI Response 타입: <class 'openai.types.responses.response.Response'>
INFO:main:Output 아이템 수: 2
INFO:main:Output 아이템 0 타입: <class 'openai.types.responses.response_function_web_search.ResponseFunctionWebSearch'>
INFO:main:웹 검색 결과 건너뛰기: web_search_call
INFO:main:Output 아이템 1 타입: <class 'openai.types.responses.response_output_message.ResponseOutputMessage'>
INFO:main:Content 아이템 수: 1
INFO:main:Content 아이템 0 타입: <class 'openai.types.responses.response_output_text.ResponseOutputText'>
INFO:main:텍스트 추출 성공: {
  "expert_diagnosis": "피부가 민감하고 여드름이 많아 고민이시군요.",
  "predicted_skin_age": "20대 중반",
  "predicted_s...
INFO:main:OpenAI 프롬프트 응답 (처음 200자): {
  "expert_diagnosis": "피부가 민감하고 여드름이 많아 고민이시군요.",
  "predicted_skin_age": "20대 중반",
  "predicted_skin_sensitivity": "높음",
  "skin_tone_palette": [
    "어두운 웜톤 (Type V)"
  ],
  "survey_highlights": [...
INFO:main:JSON 부분 추출됨: {
  "expert_diagnosis": "피부가 민감하고 여드름이 많아 고민이시군요.",
  "predicted_skin_age": "20대 중반",
  "predicted_skin_sensitivity": "높음",
  "skin_tone_palette": [
    "어두운 웜톤 (Type V)"
  ],
  "survey_highlights": [...
INFO:main:✅ OpenAI 제품 추천 개수: 2
INFO:main:제품 1: 나이팅게일 세파시카 앰플
INFO:main:  브랜드: 나이팅게일
INFO:main:  가격: ₩23,000
INFO:main:  URL: https://www.hwahae.co.kr/app/products/12345
INFO:main:  이미지 URL: https://www.hwahae.co.kr/app/products/12345/image
INFO:main:  요약: 민감한 피부를 진정시키고 여드름 케어에 도움을 주는 앰플이에요.
INFO:main:제품 2: 라로슈포제 시카플라스트 밤 B5
INFO:main:  브랜드: 라로슈포제
INFO:main:  가격: ₩18,000
INFO:main:  URL: https://www.hwahae.co.kr/app/products/67890
INFO:main:  이미지 URL: https://www.hwahae.co.kr/app/products/67890/image
INFO:main:  요약: 수분을 공급하고 피부를 진정시키는 크림으로, 민감성 피부에 좋아요.
INFO:main:🚀 강제로 화해 검색 실행 - OpenAI 제품 수: 2
INFO:main:🔍 OpenAI 추천 제품을 화해에서 검색 시작...
INFO:hwahae_scraper:🔍 제품 1 화해 검색: 나이팅게일 나이팅게일 세파시카 앰플
INFO:hwahae_scraper:🔍 Playwright로 화해 검색: '나이팅게일 세파시카 앰플'
INFO:hwahae_scraper:검색 URL: https://www.hwahae.co.kr/search?keyword=%EB%82%98%EC%9D%B4%ED%8C%85%EA%B2%8C%EC%9D%BC%20%EC%84%B8%ED%8C%8C%EC%8B%9C%EC%B9%B4%20%EC%95%B0%ED%94%8C&tab=goods
INFO:hwahae_scraper:방법2: 47개 제품 카드 발견
INFO:hwahae_scraper:제품 링크 10개 발견
INFO:hwahae_scraper:선택된 제품 URL: https://www.hwahae.co.kr/goods/67703 (매칭점수: 0)
INFO:hwahae_scraper:최종 URL: https://www.hwahae.co.kr/goods/67703
INFO:hwahae_scraper:최종 이미지: https://img.hwahae.co.kr/products/1918760/1918760_20230628115919.jpg?size=80x80
INFO:hwahae_scraper:✅ 제품 발견: 1
비플레인녹두 약산성 클렌징폼
4.61
39,245
INFO:hwahae_scraper:✅ 제품 1 검색 성공: 1
비플레인녹두 약산성 클렌징폼
4.61
39,245
INFO:hwahae_scraper:🔍 제품 2 화해 검색: 라로슈포제 라로슈포제 시카플라스트 밤 B5
INFO:hwahae_scraper:🔍 Playwright로 화해 검색: '라로슈포제 시카플라스트 밤 B5'
INFO:hwahae_scraper:검색 URL: https://www.hwahae.co.kr/search?keyword=%EB%9D%BC%EB%A1%9C%EC%8A%88%ED%8F%AC%EC%A0%9C%20%EC%8B%9C%EC%B9%B4%ED%94%8C%EB%9D%BC%EC%8A%A4%ED%8A%B8%20%EB%B0%A4%20B5&tab=goods
INFO:hwahae_scraper:방법2: 47개 제품 카드 발견
INFO:hwahae_scraper:제품 링크 10개 발견
INFO:hwahae_scraper:선택된 제품 URL: https://www.hwahae.co.kr/goods/46604 (매칭점수: 1)
INFO:hwahae_scraper:최종 URL: https://www.hwahae.co.kr/goods/46604
INFO:hwahae_scraper:최종 이미지: https://img.hwahae.co.kr/products/1984093/1984093_20220801000000.jpg?size=80x80
WARNING:main:⏰ 화해 검색 타임아웃(15초), OpenAI 원본 정보 유지
INFO:main:✅ OpenAI API 호출 성공!
INFO:main:🔍 OpenAI 분석 내용: {'expert_diagnosis': '피부가 민감하고 여드름이 많아 고민이시군요.', 'predicted_skin_age': '20대 중반', 'predicted_skin_sensitivity': '높음', 'skin_tone_palette': ['어두운 웜톤 (Type V)'], 'survey_highlights': ['여드름이 많음', '민감성 피부', '어두운 웜톤'], 'detailed_analysis': {'skin_condition': '피부가 민감하고 여드름이 많아 고민이시군요. 수분도는 25로 낮고, 유분도는 40으로 중간 정도예요. 피부톤은 어두운 웜톤이시네요.', 'key_points': '수분 부족으로 인해 피부가 더 민감해질 수 있어요. 여드름 관리와 함께 수분 공급에 신경 써야 해요.', 'improvement_direction': '저자극성 제품을 사용하여 피부 진정을 도모하고, 수분을 충분히 공급해 주세요. 여드름 전용 제품을 사용하여 트러블을 관리하는 것도 중요해요.'}, 'purchase_considerations': [{'reason': '민감성 피부와 여드름 고민을 동시에 해결할 수 있는 제품이 필요해요.', 'recommendation': '저자극성이고 여드름 케어에 효과적인 제품을 선택하세요.'}], 'product_recommendations': [{'reason': '민감성 피부와 여드름 케어에 효과적인 제품으로, 피부 진정과 보습에 도움을 줍니다.', 'product_name': '나이팅게일 세파시카 앰플', 'brand': '나이팅게일', 'price': '₩23,000', 'url': 'https://www.hwahae.co.kr/app/products/12345', 'image_url': 'https://www.hwahae.co.kr/app/products/12345/image', 'short_summary': '민감한 피부를 진정시키고 여드름 케어에 도움을 주는 앰플이에요.'}, {'reason': '수분 공급과 피부 진정에 효과적이며, 민감성 피부에도 적합한 제품입니다.', 'product_name': '라로슈포제 시카플라스트 밤 B5', 'brand': '라로슈포제', 'price': '₩18,000', 'url': 'https://www.hwahae.co.kr/app/products/67890', 'image_url': 'https://www.hwahae.co.kr/app/products/67890/image', 'short_summary': '수분을 공급하고 피부를 진정시키는 크림으로, 민감성 피부에 좋아요.'}]}
INFO:     127.0.0.1:63814 - "POST /analyze-skin-base64 HTTP/1.1" 200 OK
